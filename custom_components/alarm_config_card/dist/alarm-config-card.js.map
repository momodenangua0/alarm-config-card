{"version":3,"file":"alarm-config-card.js","sources":["../../../src/alarm-config-card.ts"],"sourcesContent":["class AlarmConfigCard extends HTMLElement {\n  private _hass: any = null;\n  private _config: AlarmConfigCardConfig | null = null;\n  private _inputValue = \"\";\n  private _statusMessage = \"\";\n  private _selectedEntity = \"\";\n  private _triggerType = \"motion\";\n  private _alertMethod = \"sound\";\n\n  static getStubConfig(): AlarmConfigCardConfig {\n    return {\n      type: \"custom:alarm-config-card\",\n      entity: \"sensor.alarm_config_responsible_people\",\n      alarm_entity: \"\",\n      trigger_type: \"motion\",\n      alert_method: \"sound\",\n    };\n  }\n\n  setConfig(config: AlarmConfigCardConfig): void {\n    if (!config) {\n      throw new Error(\"Invalid configuration\");\n    }\n\n    this._config = {\n      type: \"custom:alarm-config-card\",\n      entity: \"sensor.alarm_config_responsible_people\",\n      ...config,\n    };\n    this._selectedEntity = this._config.alarm_entity || \"\";\n    this._triggerType = this._config.trigger_type || \"motion\";\n    this._alertMethod = this._config.alert_method || \"sound\";\n\n    if (!this.shadowRoot) {\n      this.attachShadow({ mode: \"open\" });\n    }\n  }\n\n  set hass(hass: any) {\n    this._hass = hass;\n    this._render();\n  }\n\n  getCardSize(): number {\n    return 2;\n  }\n\n  private _getStateObj(): any | null {\n    if (!this._hass || !this._config?.entity) {\n      return null;\n    }\n    return this._hass.states[this._config.entity] || null;\n  }\n\n  private _render(): void {\n    if (!this.shadowRoot) {\n      return;\n    }\n\n    const stateObj = this._getStateObj();\n    const people = Array.isArray(stateObj?.attributes?.people)\n      ? stateObj.attributes.people\n      : [];\n\n    const peopleRaw =\n      stateObj?.attributes?.people_raw ||\n      (people.length ? people.join(\"\\n\") : \"\");\n\n    if (!this._inputValue) {\n      this._inputValue = peopleRaw;\n    }\n\n    const missingEntity = !stateObj;\n    const entityOptions = this._getEntityOptions();\n    const entitySelectOptions = entityOptions.length\n      ? entityOptions\n          .map((entityId) => {\n            const selected = entityId === this._selectedEntity ? \" selected\" : \"\";\n            return `<option value=\"${this._escapeHtml(entityId)}\"${selected}>${this._escapeHtml(entityId)}</option>`;\n          })\n          .join(\"\")\n      : `<option value=\"\">No entities available</option>`;\n\n    this.shadowRoot.innerHTML = `\n      <style>\n        :host {\n          display: block;\n        }\n        ha-card {\n          padding: 16px;\n        }\n        .title {\n          font-size: 1.2rem;\n          font-weight: 600;\n          margin-bottom: 8px;\n        }\n        .help {\n          font-size: 0.9rem;\n          color: var(--secondary-text-color);\n          margin-bottom: 8px;\n        }\n        .section {\n          margin-bottom: 16px;\n        }\n        .field {\n          display: grid;\n          gap: 6px;\n          margin-bottom: 10px;\n        }\n        label {\n          font-size: 0.85rem;\n          color: var(--secondary-text-color);\n        }\n        select {\n          padding: 6px 8px;\n          border-radius: 6px;\n          border: 1px solid var(--divider-color);\n          background: var(--card-background-color);\n          color: var(--primary-text-color);\n        }\n        textarea {\n          width: 100%;\n          min-height: 140px;\n          resize: vertical;\n          padding: 8px;\n          box-sizing: border-box;\n          font-family: monospace;\n          font-size: 0.9rem;\n        }\n        .actions {\n          margin-top: 12px;\n          display: flex;\n          gap: 8px;\n        }\n        button {\n          padding: 6px 12px;\n          border: 0;\n          border-radius: 6px;\n          background: var(--primary-color);\n          color: var(--text-primary-color, #fff);\n          cursor: pointer;\n        }\n        button.secondary {\n          background: var(--secondary-background-color);\n          color: var(--primary-text-color);\n        }\n        .status {\n          margin-top: 8px;\n          font-size: 0.9rem;\n          color: var(--secondary-text-color);\n        }\n        .warning {\n          margin-top: 8px;\n          padding: 8px;\n          background: var(--error-color);\n          color: #fff;\n          border-radius: 6px;\n        }\n      </style>\n      <ha-card>\n        <div class=\"title\">Alarm Config</div>\n        <div class=\"section\">\n          <div class=\"help\">Select a target entity and define how the alarm should trigger.</div>\n          <div class=\"field\">\n            <label for=\"alarm-entity\">Target entity</label>\n            <select id=\"alarm-entity\">\n              <option value=\"\">Select an entity</option>\n              ${entitySelectOptions}\n            </select>\n          </div>\n          <div class=\"field\">\n            <label for=\"trigger-type\">Trigger type</label>\n            <select id=\"trigger-type\">\n              <option value=\"motion\">Motion detected</option>\n              <option value=\"attic_motion\">Attic motion (any time)</option>\n              <option value=\"door_open_60s\">Door open 60s</option>\n              <option value=\"panic_button\">Panic button</option>\n              <option value=\"smoke\">Smoke detector</option>\n              <option value=\"emergency_exit\">Emergency exit opened</option>\n              <option value=\"emergency_button\">Emergency button</option>\n            </select>\n          </div>\n          <div class=\"field\">\n            <label for=\"alert-method\">Alert method</label>\n            <select id=\"alert-method\">\n              <option value=\"sound\">Sound alert</option>\n              <option value=\"mobile\">HA mobile notification</option>\n              <option value=\"email\">Email notification</option>\n            </select>\n          </div>\n        </div>\n        <div class=\"help\">Responsible people (one per line).</div>\n        <textarea id=\"people\">${this._escapeHtml(this._inputValue)}</textarea>\n        <div class=\"actions\">\n          <button id=\"save\">Save</button>\n          <button id=\"clear\" class=\"secondary\">Clear</button>\n        </div>\n        ${missingEntity ? `<div class=\"warning\">Entity ${this._config.entity} not found.</div>` : \"\"}\n        ${this._statusMessage ? `<div class=\"status\">${this._escapeHtml(this._statusMessage)}</div>` : \"\"}\n      </ha-card>\n    `;\n\n    const textarea = this.shadowRoot.getElementById(\"people\") as HTMLTextAreaElement | null;\n    if (textarea) {\n      textarea.addEventListener(\"input\", (event) => {\n        this._inputValue = (event.target as HTMLTextAreaElement).value;\n      });\n    }\n\n    const entitySelect = this.shadowRoot.getElementById(\"alarm-entity\") as HTMLSelectElement | null;\n    if (entitySelect) {\n      entitySelect.value = this._selectedEntity;\n      entitySelect.addEventListener(\"change\", (event) => {\n        this._selectedEntity = (event.target as HTMLSelectElement).value;\n      });\n    }\n\n    const triggerSelect = this.shadowRoot.getElementById(\"trigger-type\") as HTMLSelectElement | null;\n    if (triggerSelect) {\n      triggerSelect.value = this._triggerType;\n      triggerSelect.addEventListener(\"change\", (event) => {\n        this._triggerType = (event.target as HTMLSelectElement).value;\n      });\n    }\n\n    const alertSelect = this.shadowRoot.getElementById(\"alert-method\") as HTMLSelectElement | null;\n    if (alertSelect) {\n      alertSelect.value = this._alertMethod;\n      alertSelect.addEventListener(\"change\", (event) => {\n        this._alertMethod = (event.target as HTMLSelectElement).value;\n      });\n    }\n\n    const saveButton = this.shadowRoot.getElementById(\"save\");\n    if (saveButton) {\n      saveButton.addEventListener(\"click\", () => this._handleSave());\n    }\n\n    const clearButton = this.shadowRoot.getElementById(\"clear\");\n    if (clearButton) {\n      clearButton.addEventListener(\"click\", () => this._handleClear());\n    }\n  }\n\n  private _handleSave(): void {\n    if (!this._hass) {\n      return;\n    }\n    this._hass.callService(\"alarm_config\", \"set_responsible_people\", {\n      people: this._inputValue || \"\",\n    });\n    if (this._config) {\n      this._config.alarm_entity = this._selectedEntity;\n      this._config.trigger_type = this._triggerType;\n      this._config.alert_method = this._alertMethod;\n    }\n    this._statusMessage = \"Saved\";\n    this._render();\n  }\n\n  private _handleClear(): void {\n    if (!this._hass) {\n      return;\n    }\n    this._inputValue = \"\";\n    this._hass.callService(\"alarm_config\", \"clear_responsible_people\", {});\n    this._statusMessage = \"Cleared\";\n    this._render();\n  }\n\n  private _escapeHtml(value: string): string {\n    return String(value)\n      .replace(/&/g, \"&amp;\")\n      .replace(/</g, \"&lt;\")\n      .replace(/>/g, \"&gt;\")\n      .replace(/\\\"/g, \"&quot;\")\n      .replace(/'/g, \"&#39;\");\n  }\n\n  private _getEntityOptions(): string[] {\n    if (!this._hass || !this._hass.states) {\n      return [];\n    }\n    const allowedDomains = new Set([\n      \"binary_sensor\",\n      \"sensor\",\n      \"switch\",\n      \"lock\",\n      \"cover\",\n    ]);\n    return Object.keys(this._hass.states)\n      .filter((entityId) => allowedDomains.has(entityId.split(\".\")[0]))\n      .sort();\n  }\n}\n\ninterface AlarmConfigCardConfig {\n  type?: string;\n  entity?: string;\n  alarm_entity?: string;\n  trigger_type?: string;\n  alert_method?: string;\n}\n\ncustomElements.define(\"alarm-config-card\", AlarmConfigCard);\n\nwindow.customCards = window.customCards || [];\nwindow.customCards.push({\n  type: \"alarm-config-card\",\n  name: \"Alarm Config Card\",\n  description: \"Manage responsible people for alarms.\",\n});\n"],"names":["AlarmConfigCard","HTMLElement","constructor","this","_hass","_config","_inputValue","_statusMessage","_selectedEntity","_triggerType","_alertMethod","getStubConfig","type","entity","alarm_entity","trigger_type","alert_method","setConfig","config","Error","Object","assign","shadowRoot","attachShadow","mode","hass","_render","getCardSize","_getStateObj","_a","states","stateObj","people","Array","isArray","attributes","peopleRaw","_b","people_raw","length","join","missingEntity","entityOptions","_getEntityOptions","entitySelectOptions","map","entityId","selected","_escapeHtml","innerHTML","textarea","getElementById","addEventListener","event","target","value","entitySelect","triggerSelect","alertSelect","saveButton","_handleSave","clearButton","_handleClear","callService","String","replace","allowedDomains","Set","keys","filter","has","split","sort","customElements","define","window","customCards","push","name","description"],"mappings":"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"}